<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aile Hatim & CevÅŸen Takibi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .progress-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .person-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
        }

        .person-card h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .person-card .progress {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .person-card .detail {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .current-reading {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .current-reading h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .reading-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .reading-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .reading-item.completed {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .reading-item h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .reading-item .pages {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .juz-section {
            margin-bottom: 25px;
            background: #fafafa;
            padding: 20px;
            border-radius: 15px;
        }

        .juz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .juz-header h3 {
            color: #667eea;
            font-size: 1.5em;
        }

        .juz-progress {
            font-size: 0.9em;
            color: #666;
        }

        .page-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .page-block {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .page-block.completed {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .page-block .person-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .page-block .page-range {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .page-block .checkmark {
            font-size: 1.5em;
            margin-top: 5px;
        }

        /* CevÅŸen Styles */
        .cevsen-container {
            background: #fafafa;
            padding: 25px;
            border-radius: 15px;
        }

        .date-selector {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .date-selector h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .date-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .date-controls button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
        }

        .date-controls button:hover {
            background: #5568d3;
        }

        .date-controls input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            text-align: center;
        }

        .current-date {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .cevsen-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .cevsen-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cevsen-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .cevsen-card.completed {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border-color: #4caf50;
        }

        .cevsen-card h4 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .cevsen-card .pages {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .cevsen-card .status {
            font-size: 2em;
            margin-top: 10px;
        }

        .cevsen-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .reset-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
            transition: background 0.3s ease;
        }

        .reset-btn:hover {
            background: #d32f2f;
        }

        .action-buttons {
            text-align: center;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .page-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ•Œ Aile Ä°badet Takibi</h1>
        <p class="subtitle">HayÄ±rlÄ± hatimler ve dualar olsun inÅŸallah ðŸ¤²</p>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('hatim')">ðŸ“– Hatim Takibi</button>
            <button class="tab" onclick="switchTab('cevsen')">ðŸ¤² CevÅŸen Takibi</button>
        </div>

        <!-- HATIM TAKÄ°BÄ° -->
        <div id="hatim-content" class="tab-content active">
            <div class="progress-summary" id="hatimProgressSummary"></div>
            <div class="current-reading" id="hatimCurrentReading"></div>
            <div id="juzContainer"></div>
            <div class="action-buttons">
                <button class="reset-btn" onclick="resetHatimProgress()">ðŸ”„ Hatim Ä°lerlemesini SÄ±fÄ±rla</button>
            </div>
        </div>

        <!-- CEVÅžEN TAKÄ°BÄ° -->
        <div id="cevsen-content" class="tab-content">
            <div class="date-selector">
                <h3>ðŸ“… Tarih SeÃ§in</h3>
                <div class="current-date" id="currentDate"></div>
                <div class="date-controls">
                    <button onclick="changeDate(-1)">â—€ Ã–nceki GÃ¼n</button>
                    <input type="date" id="dateInput" onchange="selectDate()">
                    <button onclick="changeDate(1)">Sonraki GÃ¼n â–¶</button>
                </div>
            </div>

            <div class="cevsen-stats" id="cevsenStats"></div>
            <div class="cevsen-container">
                <div class="cevsen-grid" id="cevsenGrid"></div>
            </div>
            <div class="action-buttons">
                <button class="reset-btn" onclick="resetCevsenProgress()">ðŸ”„ CevÅŸen Ä°lerlemesini SÄ±fÄ±rla</button>
            </div>
        </div>
    </div>

    <script>
        // Google Sheets API URL
        const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbyaEFCMNJtARfATbGDxVteIIuZNhgr9FQKqKd0Nx_19LLQGsbOBQ5uJCS3wqAwpixqh/exec';

        const family = [
            { name: 'Sait', hatimPages: [1, 2, 3, 4, 5], cevsenPages: '1-10', color: '#667eea' },
            { name: 'Ali', hatimPages: [6, 7, 8, 9, 10], cevsenPages: '11-41', color: '#764ba2' },
            { name: 'Anne', hatimPages: [11, 12, 13, 14, 15], cevsenPages: '42-72', color: '#f093fb' },
            { name: 'Baba', hatimPages: [16, 17, 18, 19, 20], cevsenPages: '73-101', color: '#4facfe' }
        ];

        const totalJuz = 30;
        let currentTab = 'hatim';
        let selectedDate = new Date().toISOString().split('T')[0];

        // Initialize progress - will be loaded from Google Sheets
        let hatimProgress = {};
        let cevsenProgress = {};
        let isLoading = false;

        // ========== GOOGLE SHEETS SYNC FUNCTIONS ==========
        async function loadFromSheets() {
            if (isLoading) return;
            isLoading = true;
            
            try {
                const response = await fetch(SHEETS_API_URL);
                const data = await response.json();
                
                if (data.hatim) hatimProgress = data.hatim;
                if (data.cevsen) cevsenProgress = data.cevsen;
                
                // Also save to localStorage as backup
                localStorage.setItem('hatimProgress', JSON.stringify(hatimProgress));
                localStorage.setItem('cevsenProgress', JSON.stringify(cevsenProgress));
                
                updateHatimDisplay();
                updateCevsenDisplay();
            } catch (error) {
                console.error('Veri yÃ¼klenirken hata:', error);
                // Fallback to localStorage
                hatimProgress = JSON.parse(localStorage.getItem('hatimProgress')) || {};
                cevsenProgress = JSON.parse(localStorage.getItem('cevsenProgress')) || {};
                updateHatimDisplay();
                updateCevsenDisplay();
            } finally {
                isLoading = false;
            }
        }

        async function saveToSheets() {
            if (isLoading) return;
            
            try {
                await fetch(SHEETS_API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        hatim: hatimProgress,
                        cevsen: cevsenProgress
                    })
                });
                
                // Also save to localStorage as backup
                localStorage.setItem('hatimProgress', JSON.stringify(hatimProgress));
                localStorage.setItem('cevsenProgress', JSON.stringify(cevsenProgress));
            } catch (error) {
                console.error('Veri kaydedilirken hata:', error);
                // Still save to localStorage
                localStorage.setItem('hatimProgress', JSON.stringify(hatimProgress));
                localStorage.setItem('cevsenProgress', JSON.stringify(cevsenProgress));
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');

            if (tab === 'hatim') {
                updateHatimDisplay();
            } else {
                updateCevsenDisplay();
            }
        }

        // ========== HATIM FUNCTIONS ==========
        function initializeHatimProgress() {
            for (let juz = 1; juz <= totalJuz; juz++) {
                if (!hatimProgress[juz]) {
                    hatimProgress[juz] = {};
                    family.forEach(person => {
                        hatimProgress[juz][person.name] = false;
                    });
                }
            }
            saveToSheets();
        }

        function saveHatimProgress() {
            saveToSheets();
            updateHatimDisplay();
        }

        function toggleHatimPage(juz, personName) {
            hatimProgress[juz][personName] = !hatimProgress[juz][personName];
            saveHatimProgress();
        }

        function getHatimPersonProgress(personName) {
            let completed = 0;
            for (let juz = 1; juz <= totalJuz; juz++) {
                if (hatimProgress[juz] && hatimProgress[juz][personName]) {
                    completed++;
                }
            }
            return { completed, total: totalJuz };
        }

        function getHatimCurrentReading() {
            let nextReadings = [];
            
            family.forEach(person => {
                for (let juz = 1; juz <= totalJuz; juz++) {
                    if (!hatimProgress[juz] || !hatimProgress[juz][person.name]) {
                        nextReadings.push({
                            person: person.name,
                            juz: juz,
                            pages: person.hatimPages,
                            color: person.color
                        });
                        break;
                    }
                }
            });

            return nextReadings;
        }

        function updateHatimDisplay() {
            updateHatimProgressSummary();
            updateHatimCurrentReading();
            updateJuzDisplay();
        }

        function updateHatimProgressSummary() {
            const container = document.getElementById('hatimProgressSummary');
            container.innerHTML = '';

            family.forEach(person => {
                const prog = getHatimPersonProgress(person.name);
                const percentage = Math.round((prog.completed / prog.total) * 100);
                
                const card = document.createElement('div');
                card.className = 'person-card';
                card.style.background = `linear-gradient(135deg, ${person.color} 0%, ${person.color}dd 100%)`;
                card.innerHTML = `
                    <h3>${person.name}</h3>
                    <div class="progress">${percentage}%</div>
                    <div class="detail">${prog.completed} / ${prog.total} CÃ¼z</div>
                `;
                container.appendChild(card);
            });
        }

        function updateHatimCurrentReading() {
            const container = document.getElementById('hatimCurrentReading');
            const nextReadings = getHatimCurrentReading();

            if (nextReadings.length === 0) {
                container.innerHTML = `
                    <h2>ðŸŽ‰ Hatminiz TamamlandÄ±!</h2>
                    <p style="color: #666; margin-top: 10px;">MaÅŸallah, tÃ¼m aile hatmi tamamladÄ±. Allah kabul etsin! ðŸ¤²</p>
                `;
                return;
            }

            let html = '<h2>ðŸ“– SÄ±rada Okunacak</h2><div class="reading-grid">';
            
            nextReadings.forEach(reading => {
                const isCompleted = hatimProgress[reading.juz] && hatimProgress[reading.juz][reading.person];
                html += `
                    <div class="reading-item ${isCompleted ? 'completed' : ''}">
                        <h4>${reading.person}</h4>
                        <div class="pages">${reading.juz}. CÃ¼z - Sayfa ${reading.pages[0]}-${reading.pages[4]}</div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function updateJuzDisplay() {
            const container = document.getElementById('juzContainer');
            container.innerHTML = '';

            for (let juz = 1; juz <= totalJuz; juz++) {
                let completedCount = 0;
                family.forEach(person => {
                    if (hatimProgress[juz] && hatimProgress[juz][person.name]) completedCount++;
                });

                // EÄŸer cÃ¼z tamamen tamamlandÄ±ysa gÃ¶sterme
                if (completedCount === 4) {
                    continue;
                }

                const section = document.createElement('div');
                section.className = 'juz-section';

                section.innerHTML = `
                    <div class="juz-header">
                        <h3>${juz}. CÃ¼z</h3>
                        <div class="juz-progress">${completedCount} / 4 tamamlandÄ±</div>
                    </div>
                    <div class="page-grid" id="juz-${juz}"></div>
                `;

                container.appendChild(section);

                const grid = document.getElementById(`juz-${juz}`);
                family.forEach(person => {
                    const isCompleted = hatimProgress[juz] && hatimProgress[juz][person.name];
                    const block = document.createElement('div');
                    block.className = `page-block ${isCompleted ? 'completed' : ''}`;
                    block.onclick = () => toggleHatimPage(juz, person.name);
                    block.innerHTML = `
                        <div class="person-name">${person.name}</div>
                        <div class="page-range">Sayfa ${person.hatimPages[0]}-${person.hatimPages[4]}</div>
                        ${isCompleted ? '<div class="checkmark">âœ“</div>' : ''}
                    `;
                    grid.appendChild(block);
                });
            }
        }

        function resetHatimProgress() {
            if (confirm('TÃ¼m hatim ilerlemesi sÄ±fÄ±rlanacak. Emin misiniz?')) {
                hatimProgress = {};
                initializeHatimProgress();
                alert('Hatim ilerlemesi sÄ±fÄ±rlandÄ±. HayÄ±rlÄ± hatimler! ðŸ¤²');
            }
        }

        // ========== CEVÅžEN FUNCTIONS ==========
        function initializeCevsenProgress() {
            // No initialization needed - dates are created on demand
        }

        function saveCevsenProgress() {
            saveToSheets();
            updateCevsenDisplay();
        }

        function toggleCevsen(date, personName) {
            if (!cevsenProgress[date]) {
                cevsenProgress[date] = {};
            }
            cevsenProgress[date][personName] = !cevsenProgress[date][personName];
            saveCevsenProgress();
        }

        function updateCevsenDisplay() {
            updateCurrentDate();
            updateCevsenStats();
            updateCevsenGrid();
        }

        function updateCurrentDate() {
            const dateObj = new Date(selectedDate);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const turkishDate = dateObj.toLocaleDateString('tr-TR', options);
            document.getElementById('currentDate').textContent = turkishDate;
            document.getElementById('dateInput').value = selectedDate;
        }

        function changeDate(days) {
            const date = new Date(selectedDate);
            date.setDate(date.getDate() + days);
            selectedDate = date.toISOString().split('T')[0];
            updateCevsenDisplay();
        }

        function selectDate() {
            selectedDate = document.getElementById('dateInput').value;
            updateCevsenDisplay();
        }

        function updateCevsenStats() {
            const container = document.getElementById('cevsenStats');
            
            // Count total completed days
            let totalDays = Object.keys(cevsenProgress).length;
            let fullyCompletedDays = 0;
            
            Object.keys(cevsenProgress).forEach(date => {
                let completed = 0;
                family.forEach(person => {
                    if (cevsenProgress[date][person.name]) completed++;
                });
                if (completed === 4) fullyCompletedDays++;
            });

            // Today's completion
            const todayData = cevsenProgress[selectedDate] || {};
            let todayCompleted = 0;
            family.forEach(person => {
                if (todayData[person.name]) todayCompleted++;
            });

            container.innerHTML = `
                <div class="stat-card">
                    <div class="number">${todayCompleted}/4</div>
                    <div class="label">BugÃ¼n Tamamlanan</div>
                </div>
                <div class="stat-card">
                    <div class="number">${fullyCompletedDays}</div>
                    <div class="label">Tam Tamamlanan GÃ¼n</div>
                </div>
                <div class="stat-card">
                    <div class="number">${totalDays}</div>
                    <div class="label">Toplam KayÄ±tlÄ± GÃ¼n</div>
                </div>
            `;
        }

        function updateCevsenGrid() {
            const container = document.getElementById('cevsenGrid');
            container.innerHTML = '';

            const dateData = cevsenProgress[selectedDate] || {};

            family.forEach(person => {
                const isCompleted = dateData[person.name] || false;
                const card = document.createElement('div');
                card.className = `cevsen-card ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => toggleCevsen(selectedDate, person.name);
                
                card.innerHTML = `
                    <h4>${person.name}</h4>
                    <div class="pages">Ä°sim: ${person.cevsenPages}</div>
                    <div class="status">${isCompleted ? 'âœ“ TamamlandÄ±' : 'â—‹ Bekliyor'}</div>
                `;
                
                container.appendChild(card);
            });
        }

        function resetCevsenProgress() {
            if (confirm('TÃ¼m CevÅŸen ilerlemesi sÄ±fÄ±rlanacak. Emin misiniz?')) {
                cevsenProgress = {};
                saveCevsenProgress();
                alert('CevÅŸen ilerlemesi sÄ±fÄ±rlandÄ±!');
            }
        }

        // Initialize on load
        async function init() {
            // First, load from Google Sheets
            await loadFromSheets();
            
            // If no data exists, initialize
            if (Object.keys(hatimProgress).length === 0) {
                initializeHatimProgress();
            }
            
            updateHatimDisplay();
            updateCevsenDisplay();
            
            // Reload data every 5 seconds to get updates from other users
            setInterval(loadFromSheets, 5000);
        }
        
        // Start the app
        init();
    </script>
</body>
</html>
